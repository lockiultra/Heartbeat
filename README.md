# Heartbeat API

**Описание:**  
Этот pet-проект представляет собой бекенд-сервис, реализованный с использованием FastAPI и SQLAlchemy для управления записями на приёмы в медицинском учреждении. В системе реализованы модели пользователей (пациенты и врачи) и модель встреч (Appointment) с двусторонними связями между врачами и пациентами. Проект структурирован по принципу разделения ответственности с использованием репозиториев, Pydantic-схем, роутеров, а также включает функциональность аутентификации с использованием JWT.

---

## Функциональность

- **Управление пользователями:**
  - Регистрация и управление данными пациентов и врачей.
  - Валидация и сериализация данных через Pydantic-схемы.
  
- **Записи на приёмы (Appointment):**
  - Создание, обновление, удаление и получение информации о записях.
  - Фильтрация встреч по врачу или пациенту.
  - Двусторонние связи (relationship) между встречами, врачами и пациентами.

- **Аутентификация:**
  - Генерация и проверка JWT-токенов.
  - Аутентификация пользователей через OAuth2 (получение токена).

- **Архитектура проекта:**
  - Использование паттерна Repository для работы с базой данных.
  - Чёткое разделение логики: модели, схемы, роутеры, репозитории, настройки, зависимости и тесты.

---

## Структура проекта

```
backend/
├── core/
│   ├── auth.py         # Функции для хэширования паролей и создания JWT-токенов
│   ├── db.py           # Настройка подключения к базе данных и создание таблиц
│   └── settings.py     # Настройки проекта (чтение переменных окружения)
├── tests/              # Тесты проекта
│   ├── conftest.py     # Фикстуры для тестирования (база данных, клиент)
│   ├── __init__.py
│   └── test_patient.py # Пример теста для API пациентов
├── api/
│   ├── __init__.py
│   ├── main.py         # Точка входа приложения FastAPI
│   ├── routers/        # Маршруты API
│   │   ├── __init__.py
│   │   ├── auth.py     # Эндпоинты для аутентификации (JWT)
│   │   ├── patient.py  # Эндпоинты для работы с пациентами
│   │   ├── doctor.py   # Эндпоинты для работы с врачами
│   │   └── appointment.py  # Эндпоинты для работы со встречами
│   ├── repository/     # Репозитории для работы с базой данных
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── patient.py
│   │   ├── doctor.py
│   │   └── appointment.py
│   ├── dependencies/   # Зависимости для роутеров (на данный момент пустой)
│   ├── models/         # ORM-модели
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── user.py
│   │   ├── patient.py
│   │   ├── doctor.py
│   │   └── appointment.py
│   └── schemas/        # Pydantic-схемы для валидации данных API
│       ├── __init__.py
│       ├── user.py
│       ├── patient.py
│       ├── doctor.py
│       └── appointment.py
```

---

## Установка и запуск

### Требования

- Python 3.10 или выше
- Зависимости, указанные в файле `requirements.txt`
- База данных (например, PostgreSQL, SQLite и т.п.)

**Пример переменных окружения (.env):**
```
DATABASE_URL=postgresql+asyncpg://user:password@localhost/dbname
TEST_DATABASE_URL=postgresql+asyncpg://user:password@localhost/test_dbname
ALGORITHM=HS256
SECRET_KEY=your-secret-key
```

### Установка зависимостей

```bash
python -m venv venv
source venv/bin/activate 


pip install -r requirements.txt
```

### Запуск приложения

```bash
uvicorn backend.api.main:app --reload
```

После запуска сервер будет доступен по адресу [http://127.0.0.1:8000](http://127.0.0.1:8000).  
Эндпоинт `/` возвращает простой "Heartbeat".

### Запуск тестов(В разработке)

Для запуска тестов используйте команду:

```bash
pytest
```

---

## Описание API

### Эндпоинты пациентов

- **GET /patient/** – Получить список всех пациентов.
- **GET /patient/{patient_id:int}** – Получить данные конкретного пациента по ID.
- **POST /patient/** – Создать нового пациента.
- **PUT /patient/** – Обновить данные пациента.
- **DELETE /patient/** – Удалить пациента.

### Эндпоинты врачей

- **GET /doctor/** – Получить список всех врачей.
- **GET /doctor/{doctor_id:int}** – Получить данные конкретного врача по ID.
- **POST /doctor/** – Создать нового врача.
- **PUT /doctor/** – Обновить данные врача.
- **DELETE /doctor/** – Удалить врача.

### Эндпоинты встреч (Appointment)

- **GET /appointment/by_doctor/{doctor_id:int}** – Получить список встреч по ID врача.
- **GET /appointment/by_patient/{patient_id:int}** – Получить список встреч по ID пациента.
- **GET /appointment/by_id/{appointment_id:int}** – Получить данные конкретной встречи по ID.
- **POST /appointment/** – Создать новую встречу.
- **PUT /appointment/** – Обновить данные встречи.
- **DELETE /appointment/** – Удалить встречу.

### Аутентификация

- **POST /auth/token** – Получить JWT-токен, используя OAuth2PasswordRequestForm.  
  Для аутентификации необходимо передать `username` и `password` в теле запроса.

---

## Примечания

- Проект использует асинхронное взаимодействие с базой данных посредством SQLAlchemy.
- Хэширование паролей осуществляется с помощью библиотеки Passlib (bcrypt).
- Общий базовый репозиторий реализует стандартные CRUD-операции, от которого наследуются репозитории для каждой модели.
- Создание таблиц в базе данных происходит при запуске приложения через функцию `create_tables` из модуля `backend/core/db.py`.

---
